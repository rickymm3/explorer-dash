
<div class="header">
    <h1 class="title padded-5">$projectName</h1>

    <div class="topbar v-align-mid">
        <btn icon="trash-o" @click="removeSheet()"></btn>
        <btn icon="clone" @click="copySheet()"></btn>
        <btn icon="plus-square" label="Sheet" @click="addSheet()"></btn>
        <!-- SHEET -->
        <span class="dropdown">
            <btn class="sheet-names"
                 @click="setCurrentDropDown(currentSheet)"
                 icon="caret-down"
                 :label="currentSheet.name">
            </btn>
            <div class="dropdown-list suggested-names-panel"
                 v-if="currentDropDown==currentSheet"
                 @click="currentSheetUpdate($event)">
                <div v-for="(item, id) in jsonData.sheets"
                     v-html="item.name"
                     :class="currentSheet==item ? 'isSelected' : ''"
                     :data-index="id"></div>
            </div>
        </span>

        <!--
        <dropdown   class_btn="sheet-names"
                     class_dropdown="suggested-names-panel"
                     :list="jsonData.sheets"
                     :label="currentSheet.name"
                     :dropdown_source="currentSheet"
                     :is_selected="isSheetSelected"
                     @selected="currentSheetUpdate($event)">
        </dropdown> -->

        <input class="" v-model:value="currentSheet.name">
    </div>
</div>

<div class="sidebar">
    <btn class="btn-sidebar" :class="{ active: view==0 }" @click="changeView(0)" label="Definable<br/>Values"></btn>
    <btn class="btn-sidebar" :class="{ active: view==1 }" @click="changeView(1)" label="Light<br/>Sequence"></btn>
    <btn class="btn-sidebar" :class="{ active: view==2 }" @click="changeView(2)" label="Action<br/>Sequence"></btn>
    <btn class="btn-sidebar" @click="exportSheetsPopup" label="Export<br/>Sheet(s)"></btn>
    <btn class="v-align-top btn-large" :class="[statusSaveButton.toLowerCase(), isBusy ? 'busy' : '']"
         @click="handleSaveButton($event)"
         v-html="statusSaveButton"
         label="Save"></btn>

</div>

<div id="details">
    <view-tab v-if="view==0" class="view definable-values">
        <comp v-for="def in currentSheet.definableValues" v-bind:obj="def"></comp>
    </view-tab>

    <view-tab v-if="view==1" class="view light-sequence">
        <table width="100%">
            <tr>
                <td class="col-1 side-left">
                    <btn icon="plus-square" label="Light" v-on:click="addLight()"></btn>
                    <draggable :list="currentSheet.lightSequence">
                        <light-item v-for="def in currentSheet.lightSequence" v-bind:obj="def">
                        </light-item>
                    </draggable>
                </td>

                <td class="col-2">
                    <div class="panel" v-if=currentLightItem>

                        <div class="padded-3">
                            <btn class="padded-5" icon="trash-o" title="Delete item" @click="removeLight()"></btn>
                            <btn class="padded-5" icon="clone" title="Clone item" @click="copyLight(currentLightItem)"></btn>

                            <i class="inline-block padded-3">
                                <i>Name:</i>
                                <input v-model:value="currentLightItem.name">
                            </i>

                            <!-- Names Suggestion DropDown menu -->
                            <dropdown	class_btn="action-names"
                                         class_dropdown="suggested-names-panel"
                                         :list="currentSheet.actionSequence"
                                         :dropdown_source="currentLightItem"
                                         @selected="useSuggestedName(currentLightItem, $event, currentSheet.actionSequence)">
                            </dropdown>

                            <btn class="spacer-1" icon="play" label="Play All"></btn>
                        </div>

                        <light-comp v-if="currentLightItem"
                                header="Ring Sequence"
                                prefix="Ring"
                                class_lightcomp="ring-light"
                                class="ring-sequence"
                                :obj="currentLightItem"
                                :steps="currentLightItem.ringSteps"
                                :loops="'ringSeqLooping'"
                                :holds="'ringSeqHoldLast'">
                        </light-comp>

                        <light-comp v-if="currentLightItem"
                                header="Strip Sequence"
                                prefix="Strip"
                                class_lightcomp="strip-light"
                                class="strip-sequence"
                                :obj="currentLightItem"
                                :steps="currentLightItem.stripSteps"
                                :loops="'stripSeqLooping'"
                                :holds="'stripSeqHoldLast'">
                        </light-comp>

                        <!--<light-comp-->
                                <!--header="Strip Sequence"-->
                                <!--class="strip-sequence"-->
                                <!--:obj="currentLightItem"-->
                                <!--:steps="currentLightItem.stripSteps"-->
                                <!--:isLooping="currentLightItem.stripSeqLooping"-->
                                <!--:isHoldLast="currentLightItem.stripSeqHoldLast"-->
                                <!--:currentStep="currentStripStep"-->
                                <!--:clazzLightComp="'strip-light'">-->

                        <!--</light-comp>-->


                    </div>
                </td>
            </tr>
        </table>
    </view-tab>

    <view-tab v-if="view==2" class="view action-sequence">
        <table width="100%">
            <tr>
                <td class="col-1 side-left">
                    <btn icon="plus-square" label="Action" v-on:click="addAction()"></btn>
                    <draggable :list="currentSheet.actionSequence">
                        <action-item v-for="def in currentSheet.actionSequence" v-bind:obj="def">
                        </action-item>
                    </draggable>
                </td>

                <td class="col-2">
                    <div class="panel" v-if=currentActionItem>
                        <div class="padded-3">
                            <btn class="padded-5" icon="trash-o" title="Delete item" @click="removeAction(def)"></btn>
                            <btn class="padded-5" icon="clone" title="Clone item" @click="copyAction(currentActionItem)"></btn>

                            <i class="inline-block padded-3">
                                <i>Name:</i>
                                <input class="" v-model:value="currentActionItem.name">
                            </i>

                            <!-- Names Suggestion DropDown menu -->
                            <dropdown	class_btn="action-names"
                                         class_dropdown="suggested-names-panel"
                                         :list="currentSheet.lightSequence"
                                         :dropdown_source="currentActionItem"
                                         @selected="useSuggestedName(currentActionItem, $event, currentSheet.lightSequence)">
                            </dropdown>

                            <btn class="padded-5" icon="plus-square" title="Add an Action Parameter" label="Param" v-on:click="addActionParam()"></btn>
                        </div>

                        <i class="padded-3">
                            <i>Params Count:</i> <i v-html="currentActionItem.params.length"></i>
                        </i>

                        <draggable class="padded-3 strip-action"
                                   :list="currentActionItem.actions"
                                    :options="{ handle: '.drag-handle' }"> <!-- ERROR? strip-action class used here? -->
                            <div class="border padded-5 action-param"
                                 v-for="actionParam in currentActionItem.params">

                                <div class="inline-block">
                                    <span class="">
                                        <btn class="padded-5" icon="trash-o" title="Delete param" @click="removeActionParam(actionParam)"></btn>
                                        <btn class="padded-5" icon="clone" title="Clone param" @click="copyActionParam(actionParam)"></btn>
                                        <btn class="padded-5 drag-handle" icon="sort" title="Sort param"></btn>

                                        <!-- "Take Off" DropDown menu
                                        <span class="dropdown">
                                            <btn class="padded-5 ara-command"
                                                 @click="setCurrentDropDown(actionParam)"
                                                 >
                                            </btn>
                                            <div class="dropdown-list ara-command-panel"
                                                 v-if="currentDropDown==actionParam"
                                                 @click="selectActionType(actionParam, $event)">
                                                <div v-for="(araCmd, araID) in hardcoded.AraCommands"
                                                     v-html="araCmd.name"
                                                     :class="actionParam.type==araCmd.name ? 'isSelected' : ''"
                                                     :data-index="araID"></div>
                                            </div>
                                        </span>-->

                                        <dropdown	class_btn="ara-command"
                                                     class_dropdown="ara-command-panel"
                                                     :list="hardcoded.AraCommands"
                                                     :label="actionParam.type"
                                                     :dropdown_source="actionParam"
                                                     @selected="selectActionType(actionParam, $event)">
                                        </dropdown>
                                    </span>

                                    <div class="nowrap head">
                                        <span class="nowrap action-header">
                                            <i>Time:</i>
                                            <input class="digits-3" v-model:value="actionParam.time">
                                        </span>
                                        
                                        <br/>
                                        
                                        <span class="nowrap action-header">
                                            <i>Elevation:</i>
                                            <input class="digits-3" v-model:value="actionParam.elevation">
                                        </span>
                                    </div>
                                </div>

                                
                                <br/>
                                <i class="spacer-1 nowrap">
                                <input type="checkbox" v-model:value="actionParam.waitForRing">
                                <i>Wait For Ring</i>
                                </i>

                                <i class="spacer-1 nowrap">
                                <input type="checkbox" v-model:value="actionParam.waitForStrip">
                                <i>Wait For Strip</i>
                                </i>

                                <i class="spacer-1 nowrap">
                                <input type="checkbox" v-model:value="actionParam.waitForYaw">
                                <i>Wait For Yaw</i>
                                </i>
                            </div>
                        </draggable>

                    </div>
                </td>
            </tr>
        </table>
        
    </view-tab>
</div>

<div v-if="popup" class="modal" :class="popup!=null ? 'showing' : ''">
    <div class="popup">
        <h3 class="header" v-html="popup.header"></h3>

        <div class="content">
            <div class="message" v-html="popup.message"></div>

            <div v-if="popup.checkboxes">
                <div class="nowrap checkbox" v-for="(check, id) in popup.checkboxes">
                    <label>
                    <input type="checkbox" v-model:value="check.value" :label="check.name">
                    <div v-html="check.name"></div>
                    </label>
                </div>
            </div>
        </div>

        <div v-if="popup.dismiss" class="buttons">
            <btn v-if="popup.dismiss.ok" label="OK" @click="onPopupDismiss('ok')"></btn>
            <btn v-if="popup.dismiss.cancel" label="CANCEL" @click="onPopupDismiss('cancel')"></btn>
        </div>
    </div>
</div>